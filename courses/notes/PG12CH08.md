# Exercice PG12CH08
---

# ‚úÖ **R√©sum√© g√©n√©ral**

Ce programme COBOL **lit un fichier ESDS** (s√©quentiel) sous **z/OS**, **affiche tous les enregistrements**, puis s'arr√™te en indiquant combien d‚Äôenregistrements ont √©t√© affich√©s.

Il utilise le sch√©ma classique :
**OPEN ‚Üí READ loop ‚Üí CLOSE**

---

# üìå **Analyse du code**

## 1. **ENVIRONMENT DIVISION**

```cobol
SELECT EMPFILE ASSIGN TO AS-FEMP
ORGANIZATION IS SEQUENTIAL
ACCESS MODE IS SEQUENTIAL
FILE STATUS IS WS-FSEMP.
```

* Le fichier **EMPFILE** est un fichier **s√©quentiel** (donc ESDS en g√©n√©ral, car ESDS = acc√®s s√©quentiel).
* On fait un **file status** dans `WS-FSEMP`.

---

## 2. **FILE SECTION**

```cobol
FD EMPFILE.
01 EMPREC.
   05 EMPID    PIC X(5).
   05 FILLER   PIC X(2).
   05 EMPNOM   PIC X(10).
   05 FILLER   PIC X(2).
   05 EMPVILLE PIC X(10).
   05 FILLER   PIC X(2).
   05 EMPSAL   PIC 9(5).
   05 FILLER   PIC X(44).
```

Chaque ligne du fichier contient :

* ID employ√©
* Nom
* Ville
* Salaire
  (le reste est du remplissage)

---

## 3. **WORKING-STORAGE**

```cobol
WS-FSEMP  file status (00 = OK)
FFEMP     indicateur fin de fichier ('O' = Oui)
WS-ENR    compteur d‚Äôenregistrements lus
```

---

# 4. **PROCEDURE DIVISION**

## üîπ **INIT.**

```cobol
OPEN INPUT EMPFILE.
```

‚Üí Ouverture du fichier en lecture.

Si `WS-FSEMP ‚â† "00"` apr√®s l'ouverture, le programme affiche une erreur.

---

## üîπ **D√©but du traitement**

```cobol
READ EMPFILE
MOVE 'N' TO FFEMP
PERFORM TRAIT UNTIL FFEMP = 'O'
```

* Premier READ avant la boucle
* FFEMP = 'N' ‚Üí on entre dans la boucle TRAIT

---

## üîπ **TRAIT.**

```cobol
DISPLAY 'ENR= '  EMPREC.
ADD 1 TO WS-ENR.
READ EMPFILE.
IF WS-FSEMP NOT = '00'
   MOVE 'O' TO FFEMP
   DISPLAY 'FIN DE FICHIER...'.
```

Dans cette boucle :

### ‚úî 1. Affichage de l‚Äôenregistrement

‚Üí Montre tout le contenu EMPREC

### ‚úî 2. Incr√©mentation du compteur

### ‚úî 3. Lecture de l‚Äôenregistrement suivant

### ‚úî 4. Gestion fin de fichier

Si `WS-FSEMP` ‚â† "00"
‚Üí fin de fichier ‚Üí FFEMP = 'O' ‚Üí la boucle s‚Äôarr√™te

---

## üîπ **FIN.**

```cobol
CLOSE EMPFILE.
DISPLAY 'NBRE ENR AFFICHES: ' WS-ENR.
STOP RUN.
```

‚Üí Fermeture + affichage du nombre total d‚Äôenregistrements lus.

---

# üéØ **En r√©sum√© : que fait ce programme ?**

### ‚úî Ouvre un fichier ESDS en lecture

### ‚úî Lit le premier enregistrement

### ‚úî Boucle :

* affiche l‚Äôenregistrement
* incr√©mente un compteur
* lit l‚Äôenregistrement suivant

### ‚úî D√©tecte la fin de fichier via le file status

### ‚úî Ferme le fichier

### ‚úî Affiche le total des enregistrements lus

---

# üìò **Version simple en fran√ßais**

> Le programme lit un fichier ESDS s√©quentiel ligne par ligne, affiche chaque ligne, compte le nombre total de lignes lues, puis s‚Äôarr√™te lorsque la fin de fichier est atteinte.

---

## R√©sultat

Voici **exactement ce que produit ton programme COBOL** avec les donn√©es fournies.

---

# ‚úÖ **Analyse du programme**

Ton programme :

* **Ouvre un fichier ESDS** en mode INPUT.
* Lit le premier enregistrement.
* Puis boucle :

  * Affiche l‚Äôenregistrement courant :
    `DISPLAY "ENR= " EMPREC`
  * Affiche : `"LECTURE COURANTE"`
  * Incr√©mente le compteur `WS-ENR`
  * Lit l‚Äôenregistrement suivant
  * Si le FILE STATUS ‚â† "00", alors fin de fichier ‚Üí FFEMP = "O"

√Ä la fin :

* Le fichier est ferm√©.
* Le programme affiche :
  `"NBRE ENR AFFICHES: " WS-ENR`

---

# üìå **Important**

L‚Äôaffichage de chaque record sera de la forme :

```
ENR= 00001 COLUCCI   PARIS      00000
LECTURE COURANTE
```

*(‚Üí En r√©alit√©, les espaces correspondent exactement aux PIC X(n) du FD.)*

---

# üì§ **Sortie affich√©e par le programme**

Tu as 20 enregistrements ‚Üí Le programme va afficher **20 fois** :

```
ENR= 00001  COLUCCI    PARIS       00000
LECTURE COURANTE
ENR= 00002  DELANOE    PARIS       05500
LECTURE COURANTE
ENR= 00003  GOLDMAN    PARIS       15500
LECTURE COURANTE
ENR= 00004  HIDALGO    PARIS       12300
LECTURE COURANTE
ENR= 00005  CURIE      PARIS       00000
LECTURE COURANTE
ENR= 00006  PAGNOL     MARSEILLE   12000
LECTURE COURANTE
ENR= 00007  BEJART     MARSEILLE   09500
LECTURE COURANTE
ENR= 00008  TAPIE      MARSEILLE   00000
LECTURE COURANTE
ENR= 00009  CISSE      MARSEILLE   04325
LECTURE COURANTE
ENR= 00010  MASSALIA   MARSEILLE   00000
LECTURE COURANTE
ENR= 00011  ABIDAL     LYON        06750
LECTURE COURANTE
ENR= 00012  RENARD     LYON        08250
LECTURE COURANTE
ENR= 00013  BRAZIER    LYON        04500
LECTURE COURANTE
ENR= 00014  FRAY       LYON        02300
LECTURE COURANTE
ENR= 00015  MAGNIN     LYON        19000
LECTURE COURANTE
ENR= 00016  BENGUIGUI  LILLE       04090
LECTURE COURANTE
ENR= 00017  DE GAULLE  LILLE       00000
LECTURE COURANTE
ENR= 00018  HAMIDOU    LILLE       75000
LECTURE COURANTE
ENR= 00019  FOURATI    LILLE       11000
LECTURE COURANTE
ENR= 00020  DEGROOT    LILLE       14500
LECTURE COURANTE
```

Puis, en sortant de la boucle :

```
FIN DE FICHIER ATTEINTE OU PB RENC: 10   (ou 92 selon syst√®me)
```

*(Dans IBM z/OS, un EOF sur fichier s√©quentiel donne souvent FS = ‚Äú10‚Äù.)*

Et enfin :

```
NBRE ENR AFFICHES: 20
```

---

# üéØ **R√©sultat final affich√©**

‚úî **20 enregistrements affich√©s**
‚úî **Message de fin de fichier**
‚úî **Compteur final = 20**

---
