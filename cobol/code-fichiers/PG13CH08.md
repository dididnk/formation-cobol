# Exercice PG13CH08

---

### **1Ô∏è‚É£ Section FILE-CONTROL**

```cobol
SELECT ESDSFILE ASSIGN TO MYFILE
    ORGANIZATION IS SEQUENTIAL
    ACCESS MODE IS SEQUENTIAL
    FILE STATUS IS FS.
```

* **ESDSFILE** : nom interne du fichier dans le programme.
* **ASSIGN TO MYFILE** : correspond au DD dans ton JCL (le dataset VSAM ou ESDS √† utiliser).
* **ORGANIZATION IS SEQUENTIAL** : on lit/√©crit les enregistrements dans l‚Äôordre (s√©quentiel).
* **ACCESS MODE IS SEQUENTIAL** : les op√©rations se font s√©quentiellement, pas d‚Äôacc√®s direct par cl√©.
* **FILE STATUS IS FS** : la variable **FS** contiendra le code de statut du fichier (`00` = OK).

---

### **2Ô∏è‚É£ FD et enregistrement**

```cobol
FD ESDSFILE
    RECORDING MODE IS F
    RECORD CONTAINS 80 CHARACTERS.
01 ESDS-REC    PIC X(80).
```

* D√©clare le format physique du fichier.
* **RECORDING MODE IS F** : format fixe, chaque enregistrement fait exactement 80 caract√®res.
* **ESDS-REC** : structure COBOL pour stocker un enregistrement (ici 80 caract√®res).

---

### **3Ô∏è‚É£ WORKING-STORAGE**

```cobol
01 FS PIC XX.
```

* Variable pour stocker le **code de statut** apr√®s l‚Äôouverture, la lecture ou l‚Äô√©criture d‚Äôun fichier.
* Important pour d√©tecter les erreurs (ex: `96` = erreur de dataset VSAM).

---

### **4Ô∏è‚É£ PROCEDURE DIVISION**

```cobol
OPEN OUTPUT ESDSFILE
IF FS NOT = "00"
   DISPLAY "ERREUR OPEN : " FS
   STOP RUN
END-IF
```

* **OPEN OUTPUT** : ouvre le fichier pour **√©criture**, ce qui a deux cons√©quences :

  1. Si le fichier n‚Äôexiste pas, **il est cr√©√©** (pour un VSAM ESDS, le cluster doit d√©j√† exister).
  2. Si le fichier existe d√©j√†, tout le contenu pr√©c√©dent est **supprim√©** (le fichier est √©cras√©).
* Si `FS` n‚Äôest pas `'00'`, affiche le code d‚Äôerreur et arr√™te le programme.

---

### **5Ô∏è‚É£ √âcriture de l‚Äôenregistrement**

```cobol
MOVE "PREMIER ENREGISTREMENT DANS L'ESDS" TO ESDS-REC
WRITE ESDS-REC
```

* Place le texte **‚ÄúPREMIER ENREGISTREMENT DANS L'ESDS‚Äù** dans la variable `ESDS-REC`.
* **WRITE ESDS-REC** : √©crit cet enregistrement dans le fichier ESDS (ou PS si tu l‚Äôavais assign√© ainsi).

---

### **6Ô∏è‚É£ Fermeture**

```cobol
CLOSE ESDSFILE
STOP RUN.
```

* Ferme proprement le fichier pour valider l‚Äô√©criture.
* **STOP RUN** termine le programme.

---

### **üí° R√©sum√© fonctionnel**

* Ce programme **cr√©e ou √©crase** un fichier ESDS/VSAM assign√© √† `MYFILE`.
* Il y √©crit **un seul enregistrement** de 80 caract√®res : `"PREMIER ENREGISTREMENT DANS L'ESDS"`.
* Il **affiche une erreur** si l‚Äôouverture du fichier √©choue.

---

### **‚ö†Ô∏è Points importants pour z/OS**

1. **Le cluster ESDS doit exister** (STEP3 avec IDCAMS pour cr√©er l‚ÄôESDS).
2. **Si le cluster n‚Äôexiste pas**, tu obtiendras l‚Äôerreur **96** (OPEN OUTPUT VSAM ESDS non existant).
3. Pour tester le programme :

   * Assigne dans ton JCL le DD `MYFILE` au dataset ESDS cr√©√©.
   * Ex√©cute le programme.
   * V√©rifie que le fichier contient maintenant **un enregistrement avec ton texte**.

---
